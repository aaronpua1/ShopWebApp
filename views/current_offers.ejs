<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.shopify.com/s/assets/external/app.js"></script>
      <script language="JavaScript" src="https://code.jquery.com/jquery-1.11.1.min.js" type="text/javascript">
      </script>
      <script language="JavaScript" src="https://cdn.datatables.net/1.10.4/js/jquery.dataTables.min.js" type="text/javascript">
      </script>
      <script language="JavaScript" src="https://cdn.datatables.net/plug-ins/3cfcc339e89/integration/bootstrap/3/dataTables.bootstrap.js" type="text/javascript">
      </script>
      <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css">
      <link href="http://cdn.datatables.net/plug-ins/3cfcc339e89/integration/bootstrap/3/dataTables.bootstrap.css" rel="stylesheet" type="text/css">
    <script type="text/javascript">
    ShopifyApp.init({
        apiKey: '<%= api_key %>',
        shopOrigin: 'https://<%= shop %>.myshopify.com'
    });
    </script>
    <title><%= title %></title>
</head>
<body>
  <div class="container">
    <div class="row">
      <h2 class="text-center"><%= title %></h2>
    </div>
    <div class="row">
      <div class="col-md-12">
        <table cellspacing="0" class="table table-striped table-bordered" id="datatable" width="100%">
          <thead>
            <tr>
              <th>Offer Name</th>
              <th>Offer Title</th>
              <th>Description</th>
              <th>Offer Type</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Edit</th>
              <th>Delete</th>
            </tr>
          </thead>
          <tfoot>
            <tr>
              <th>Offer Name</th>
              <th>Offer Title</th>
              <th>Description</th>
              <th>Offer Type</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Edit</th>
              <th>Delete</th>
            </tr>
          </tfoot>
          <tbody>
            <% for(var i = 0; i < current_offers.metafields.length; i++) { %>
                <tr>
                  <td><%= current_offers.metafields[i].offer_name %></td>
                  <td><%= current_offers.metafields[i].offer_title %></td>
                  <td><%= current_offers.metafields[i].offer_description %></td>
                  <td><%= current_offers.metafields[i].offer_type %></td>
                  <td><%= current_offers.metafields[i].upsell_products %></td>
                  <td><%= current_offers.metafields[i].products %></td>
                  <td>
                    <p data-placement="top" data-toggle="tooltip" title="Edit"><button class="btn btn-primary btn-xs edit" name="edit" id=<%= current_offers.metafields[i].id %> data-target="#edit" data-title="Edit" data-toggle="modal" value=<%= current_offers.metafields[i].id %>><span class="glyphicon glyphicon-pencil"></span></button></p>
                  </td>
                  <td>
                    <p data-placement="top" data-toggle="tooltip" title="Delete"><button class="btn btn-danger btn-xs delete" name="delete" id=<%= current_offers.metafields[i].id %> data-target="#delete" data-title="Delete" data-toggle="modal" value=<%= current_offers.metafields[i].id %>><span class="glyphicon glyphicon-trash"></span></button></p>
                  </td>
                </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
<style>
.pagination>li {
display: inline;
padding:0px !important;
margin:0px !important;
border:none !important;
}
.modal-backdrop {
  z-index: -1 !important;
}
/*
Fix to show in full screen demo
*/
iframe
{
    height:700px !important;
}
.btn {
display: inline-block;
padding: 6px 12px !important;
margin-bottom: 0;
font-size: 14px;
font-weight: 400;
line-height: 1.42857143;
text-align: center;
white-space: nowrap;
vertical-align: middle;
-ms-touch-action: manipulation;
touch-action: manipulation;
cursor: pointer;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
background-image: none;
border: 1px solid transparent;
border-radius: 4px;
}
.btn-primary {
color: #fff !important;
background: #428bca !important;
border-color: #357ebd !important;
box-shadow:none !important;
}
.btn-danger {
color: #fff !important;
background: #d9534f !important;
border-color: #d9534f !important;
box-shadow:none !important;
}
</style>

<script type="text/javascript">
ShopifyApp.ready(function() {
    $('.delete').click(function() {
        ShopifyApp.Modal.confirm({
            title: "Delete offer?",
            message: "Do you want to delete this offer?",
            okButton: "Yes, delete this offer",
            cancelButton: "No, keep this offer",
            style: "danger"
        }, 
        function(result) {
            if (result) {
                $.ajax({
                    url:'/delete-offer,
                    type:'GET',
                    data: { id: this.id },
                    contentType: 'application/JSON',
                    dataType: 'json',
                    success:function(data){
                        $('#' + this.id.toString()).closest('tr').remove();
                        return false;
                    },
                    error: function(data){
                        return false;
                    }
                }).done(function(data) {
                    console.log(data);
                });
            }
        });
    });
    
    $('.edit').click(function() {
        $.get('update-offer', function(response) {
            console.log(response);
        });
    });
    
    //$('#datatable').dataTable();    
    //$("[data-toggle=tooltip]").tooltip();
});

$(document).ready(function() {
    $('#datatable').dataTable();
    
     $("[data-toggle=tooltip]").tooltip();
    
} );
</script>
</body>
</html>